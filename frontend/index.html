<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>API Rate Limiter — Control Center</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg:        #080c12;
            --surface:   #0f1520;
            --surface2:  #161e2e;
            --border:    rgba(255,255,255,0.07);
            --border-hi: rgba(100,220,255,0.25);

            --cyan:   #3de6f5;
            --teal:   #00c9a7;
            --amber:  #f5a623;
            --rose:   #ff4d6d;
            --violet: #9b72ff;

            --text:     #e8edf5;
            --text-dim: #6b7a94;
            --text-mid: #a0aec0;

            --success: #00e5a0;
            --warn:    #f5a623;
            --error:   #ff4d6d;
        }

        html, body {
            height: 100%;
            background: var(--bg);
            color: var(--text);
            font-family: 'Syne', sans-serif;
            overflow-x: hidden;
        }

        /* ── NOISE OVERLAY ── */
        body::before {
            content: '';
            position: fixed; inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
            pointer-events: none; z-index: 0; opacity: .35;
        }

        /* ── AMBIENT GLOW ── */
        .ambient {
            position: fixed; border-radius: 50%; pointer-events: none; filter: blur(120px); z-index: 0;
        }
        .ambient-1 { width: 500px; height: 500px; top: -150px; left: -100px; background: radial-gradient(circle, rgba(61,230,245,0.08), transparent 70%); }
        .ambient-2 { width: 400px; height: 400px; bottom: 0; right: -80px; background: radial-gradient(circle, rgba(155,114,255,0.07), transparent 70%); }

        /* ── LAYOUT ── */
        #loginSection {
            position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
            z-index: 100;
        }

        #appSection { display: none; min-height: 100vh; }
        #appSection.visible { display: block; }

        .container {
            max-width: 1280px; margin: 0 auto;
            padding: 28px 24px 60px;
            position: relative; z-index: 1;
        }

        /* ── SCROLLBAR ── */
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: var(--surface); }
        ::-webkit-scrollbar-thumb { background: rgba(61,230,245,0.3); border-radius: 3px; }

        /* ══ LOGIN ══════════════════════════════════════════════════════ */
        .login-card {
            position: relative; z-index: 1;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 52px 44px;
            width: min(420px, 92vw);
            box-shadow: 0 30px 80px rgba(0,0,0,0.5);
            animation: fadeUp .6s cubic-bezier(.16,1,.3,1) both;
        }

        .login-card::before {
            content: '';
            position: absolute; inset: 0; border-radius: 20px;
            background: linear-gradient(135deg, rgba(61,230,245,0.05), transparent 60%);
            pointer-events: none;
        }

        .login-logo {
            font-size: 11px; font-family: 'Space Mono', monospace;
            letter-spacing: .18em; color: var(--cyan); margin-bottom: 32px;
            display: flex; align-items: center; gap: 8px;
        }

        .login-logo .dot {
            width: 6px; height: 6px; border-radius: 50%; background: var(--cyan);
            animation: blink 1.4s infinite;
        }

        .login-title { font-size: 28px; font-weight: 800; line-height: 1.15; margin-bottom: 6px; }
        .login-subtitle { font-size: 13px; color: var(--text-mid); margin-bottom: 36px; }

        .field { margin-bottom: 18px; }
        .field label { display: block; font-size: 11px; letter-spacing: .1em; color: var(--text-dim); margin-bottom: 8px; font-family: 'Space Mono', monospace; }

        .field input {
            width: 100%;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 13px 16px;
            color: var(--text);
            font-size: 14px;
            font-family: 'Space Mono', monospace;
            transition: border-color .2s, box-shadow .2s;
            outline: none;
        }
        .field input::placeholder { color: var(--text-dim); }
        .field input:focus {
            border-color: var(--cyan);
            box-shadow: 0 0 0 3px rgba(61,230,245,0.1);
        }

        .btn-primary {
            width: 100%; padding: 13px; border-radius: 10px; border: none; cursor: pointer;
            background: var(--cyan); color: var(--bg);
            font-family: 'Syne', sans-serif; font-weight: 700; font-size: 14px;
            letter-spacing: .04em;
            transition: background .2s, transform .15s, box-shadow .2s;
            position: relative; overflow: hidden;
        }
        .btn-primary:hover { background: #6aedff; box-shadow: 0 0 30px rgba(61,230,245,0.3); transform: translateY(-1px); }
        .btn-primary:active { transform: translateY(0); }

        .login-hint { margin-top: 20px; font-size: 11px; color: var(--text-dim); font-family: 'Space Mono', monospace; text-align: center; }
        .login-hint span { color: var(--cyan); }

        #loginAlert { margin-bottom: 14px; font-size: 13px; display: none; }
        #loginAlert.error { color: var(--error); }
        #loginAlert.success { color: var(--success); }

        /* ══ DASHBOARD HEADER ═══════════════════════════════════════════ */
        .dash-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px 0 32px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 32px; flex-wrap: wrap; gap: 16px;
        }

        .dash-brand { font-size: 13px; font-family: 'Space Mono', monospace; letter-spacing: .12em; color: var(--text-dim); display: flex; align-items: center; gap: 10px; }
        .dash-brand .status-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--success); animation: blink 1.4s infinite; }

        .dash-title { font-size: 30px; font-weight: 800; letter-spacing: -.02em; }
        .dash-title span { color: var(--cyan); }

        .dash-actions { display: flex; gap: 8px; }

        .btn-ghost {
            padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border);
            background: transparent; color: var(--text-mid);
            font-family: 'Syne', sans-serif; font-size: 12px; font-weight: 600; cursor: pointer;
            transition: all .2s; letter-spacing: .04em;
        }
        .btn-ghost:hover { border-color: var(--border-hi); color: var(--text); background: var(--surface2); }
        .btn-ghost.danger:hover { border-color: var(--error); color: var(--error); }

        /* ══ USER INFO BAR ══════════════════════════════════════════════ */
        .user-bar {
            display: flex; align-items: center; gap: 0;
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 12px; overflow: hidden; margin-bottom: 28px;
        }

        .user-bar-item {
            flex: 1; padding: 16px 20px;
            border-right: 1px solid var(--border);
        }
        .user-bar-item:last-child { border-right: none; }

        .ub-label { font-size: 10px; letter-spacing: .12em; color: var(--text-dim); font-family: 'Space Mono', monospace; margin-bottom: 5px; }
        .ub-value { font-size: 15px; font-weight: 700; color: var(--text); }
        .ub-value.online { color: var(--success); }
        .ub-value.mono { font-family: 'Space Mono', monospace; font-size: 13px; }

        /* Health indicator inline */
        .health-badge {
            display: inline-flex; align-items: center; gap: 6px;
            font-size: 13px; font-weight: 600;
        }
        .health-badge .h-dot {
            width: 8px; height: 8px; border-radius: 50%;
        }
        .health-badge.stable .h-dot { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .health-badge.warning .h-dot { background: var(--warn); box-shadow: 0 0 8px var(--warn); animation: blink 0.8s infinite; }
        .health-badge.danger .h-dot { background: var(--error); box-shadow: 0 0 8px var(--error); animation: blink 0.4s infinite; }
        .health-badge.stable { color: var(--success); }
        .health-badge.warning { color: var(--warn); }
        .health-badge.danger { color: var(--error); }

        /* ══ STATS GRID ═════════════════════════════════════════════════ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px; margin-bottom: 28px;
        }

        @media (max-width: 900px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 480px) { .stats-grid { grid-template-columns: 1fr; } }

        .stat-card {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 14px; padding: 22px 20px;
            transition: border-color .25s, transform .25s;
            position: relative; overflow: hidden;
        }
        .stat-card::after {
            content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--cyan), transparent);
            opacity: 0; transition: opacity .3s;
        }
        .stat-card:hover { border-color: var(--border-hi); transform: translateY(-2px); }
        .stat-card:hover::after { opacity: 1; }

        .sc-label { font-size: 10px; letter-spacing: .12em; color: var(--text-dim); font-family: 'Space Mono', monospace; margin-bottom: 10px; }
        .sc-value { font-size: 38px; font-weight: 800; letter-spacing: -.03em; color: var(--text); line-height: 1; margin-bottom: 14px; }
        .sc-value.cyan { color: var(--cyan); }
        .sc-value.teal { color: var(--teal); }
        .sc-value.amber { color: var(--amber); }
        .sc-value.violet { color: var(--violet); }

        .track { height: 3px; background: rgba(255,255,255,0.06); border-radius: 2px; overflow: hidden; }
        .fill { height: 100%; border-radius: 2px; transition: width .6s cubic-bezier(.4,0,.2,1); }
        .fill.cyan { background: var(--cyan); box-shadow: 0 0 8px var(--cyan); }
        .fill.teal { background: var(--teal); box-shadow: 0 0 8px var(--teal); }
        .fill.amber { background: var(--amber); box-shadow: 0 0 8px var(--amber); }
        .fill.violet { background: var(--violet); box-shadow: 0 0 8px var(--violet); }

        .sc-sub { font-size: 11px; color: var(--text-dim); margin-top: 6px; font-family: 'Space Mono', monospace; }

        /* ══ GAUGE ══════════════════════════════════════════════════════ */
        .gauge-section {
            display: flex; align-items: center; justify-content: center;
            padding: 32px; background: var(--surface); border: 1px solid var(--border);
            border-radius: 14px; margin-bottom: 28px; gap: 40px; flex-wrap: wrap;
        }

        .gauge-wrap { position: relative; width: 160px; height: 160px; }
        .gauge-svg { transform: rotate(-90deg); }
        .gauge-bg { fill: none; stroke: rgba(255,255,255,0.05); stroke-width: 8; }
        .gauge-fill {
            fill: none; stroke: var(--cyan); stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 408;
            stroke-dashoffset: 408;
            transition: stroke-dashoffset .7s cubic-bezier(.4,0,.2,1), stroke .4s;
            filter: drop-shadow(0 0 6px var(--cyan));
        }
        .gauge-center {
            position: absolute; inset: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .gauge-pct { font-size: 28px; font-weight: 800; color: var(--text); }
        .gauge-desc { font-size: 10px; color: var(--text-dim); font-family: 'Space Mono', monospace; letter-spacing: .1em; }

        .gauge-legend { display: flex; flex-direction: column; gap: 12px; }
        .gauge-legend-item { display: flex; align-items: center; gap: 10px; }
        .gl-dot { width: 8px; height: 8px; border-radius: 50%; }
        .gl-label { font-size: 12px; color: var(--text-mid); }
        .gl-val { font-size: 14px; font-weight: 700; font-family: 'Space Mono', monospace; margin-left: auto; min-width: 32px; text-align: right; }

        /* ══ CONTROLS ═══════════════════════════════════════════════════ */
        .controls-row {
            display: flex; gap: 10px; margin-bottom: 28px; flex-wrap: wrap;
        }

        .btn-action {
            padding: 12px 24px; border-radius: 10px; border: 1px solid;
            font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700;
            cursor: pointer; transition: all .2s; letter-spacing: .04em;
            display: flex; align-items: center; gap: 8px;
        }
        .btn-action.primary {
            background: var(--cyan); color: var(--bg); border-color: var(--cyan);
        }
        .btn-action.primary:hover { background: #6aedff; box-shadow: 0 0 24px rgba(61,230,245,0.35); transform: translateY(-1px); }
        .btn-action.primary:disabled { opacity: .4; cursor: not-allowed; transform: none; }

        .btn-action.outline {
            background: transparent; color: var(--text-mid); border-color: var(--border);
        }
        .btn-action.outline:hover { border-color: var(--border-hi); color: var(--text); background: var(--surface2); }

        /* ══ LOG ════════════════════════════════════════════════════════ */
        .log-section {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 14px; overflow: hidden; margin-bottom: 28px;
        }

        .log-header-bar {
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px 20px; border-bottom: 1px solid var(--border);
            flex-wrap: wrap; gap: 10px;
        }

        .log-title-text { font-size: 13px; font-weight: 700; letter-spacing: .06em; }

        .filter-pills { display: flex; gap: 6px; flex-wrap: wrap; }
        .pill {
            padding: 4px 12px; border-radius: 20px; border: 1px solid var(--border);
            font-size: 11px; color: var(--text-dim); cursor: pointer;
            font-family: 'Space Mono', monospace;
            transition: all .2s;
        }
        .pill.active { border-color: var(--cyan); color: var(--cyan); background: rgba(61,230,245,0.08); }
        .pill:hover:not(.active) { border-color: rgba(255,255,255,0.2); color: var(--text-mid); }

        .log-body { max-height: 380px; overflow-y: auto; padding: 14px; }
        .log-empty {
            text-align: center; padding: 40px; color: var(--text-dim);
            font-size: 13px; font-family: 'Space Mono', monospace;
        }

        .log-entry {
            display: flex; align-items: center; gap: 14px;
            padding: 12px 14px; border-radius: 9px; cursor: pointer;
            border: 1px solid transparent;
            transition: background .2s, border-color .2s;
            margin-bottom: 6px;
        }
        .log-entry:last-child { margin-bottom: 0; }
        .log-entry:hover { background: var(--surface2); border-color: var(--border); }

        .log-entry-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .log-entry.success .log-entry-dot { background: var(--success); box-shadow: 0 0 6px var(--success); }
        .log-entry.blocked .log-entry-dot { background: var(--error); box-shadow: 0 0 6px var(--error); }
        .log-entry.warning .log-entry-dot { background: var(--warn); box-shadow: 0 0 6px var(--warn); }

        .log-entry-main { flex: 1; min-width: 0; }
        .log-entry-ep { font-size: 13px; font-weight: 600; font-family: 'Space Mono', monospace; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .log-entry-msg { font-size: 11px; color: var(--text-dim); margin-top: 2px; }

        .log-entry-right { text-align: right; flex-shrink: 0; }
        .log-entry-time { font-size: 11px; color: var(--text-dim); font-family: 'Space Mono', monospace; }
        .log-entry-rt { font-size: 11px; margin-top: 2px; font-family: 'Space Mono', monospace; }
        .log-entry.success .log-entry-rt { color: var(--success); }
        .log-entry.blocked .log-entry-rt { color: var(--error); }
        .log-entry.warning .log-entry-rt { color: var(--warn); }

        /* expanded details */
        .log-detail {
            display: none; padding: 10px 14px 14px 36px;
            border-radius: 0 0 9px 9px; background: var(--surface2);
            margin-top: -6px; margin-bottom: 6px;
            font-family: 'Space Mono', monospace; font-size: 11px;
        }
        .log-detail.open { display: grid; grid-template-columns: 1fr 1fr; gap: 6px 20px; }
        .ld-row { display: flex; gap: 6px; }
        .ld-k { color: var(--text-dim); }
        .ld-v { color: var(--cyan); }

        /* ══ API TESTER ══════════════════════════════════════════════ */
        .tester-section {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 14px; padding: 22px; margin-bottom: 28px;
        }
        .section-title { font-size: 13px; font-weight: 700; letter-spacing: .06em; margin-bottom: 16px; }

        .tester-row { display: flex; gap: 10px; flex-wrap: wrap; }
        .tester-input {
            flex: 1; min-width: 200px;
            background: var(--surface2); border: 1px solid var(--border);
            border-radius: 8px; padding: 11px 14px;
            color: var(--text); font-family: 'Space Mono', monospace; font-size: 13px;
            outline: none; transition: border-color .2s, box-shadow .2s;
        }
        .tester-input:focus { border-color: var(--cyan); box-shadow: 0 0 0 2px rgba(61,230,245,0.1); }
        .tester-input::placeholder { color: var(--text-dim); }

        .tester-output {
            display: none; margin-top: 14px;
            background: #060a10; border: 1px solid var(--border);
            border-radius: 8px; padding: 14px;
            font-family: 'Space Mono', monospace; font-size: 12px;
            color: var(--teal); white-space: pre-wrap; word-break: break-all;
            max-height: 180px; overflow-y: auto;
        }
        .tester-output.show { display: block; }

        /* ══ ANALYTICS ══════════════════════════════════════════════ */
        .analytics-section {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 14px; overflow: hidden; margin-bottom: 28px;
        }
        .analytics-toggle {
            display: flex; align-items: center; justify-content: space-between;
            padding: 18px 22px; cursor: pointer; user-select: none;
            transition: background .2s;
        }
        .analytics-toggle:hover { background: var(--surface2); }
        .analytics-toggle-icon { transition: transform .3s; color: var(--text-dim); font-size: 12px; }
        .analytics-toggle-icon.open { transform: rotate(180deg); }

        .analytics-body {
            display: none; padding: 0 22px 22px;
        }
        .analytics-body.open { display: block; }

        .charts-grid {
            display: grid; grid-template-columns: repeat(3,1fr); gap: 16px;
        }
        @media (max-width: 900px) { .charts-grid { grid-template-columns: 1fr; } }

        .chart-box {
            background: #060a10; border-radius: 10px; padding: 14px;
            height: 220px; position: relative;
        }
        .chart-box canvas { max-height: 170px !important; }
        .chart-label { font-size: 10px; letter-spacing: .12em; color: var(--text-dim); font-family: 'Space Mono', monospace; margin-bottom: 8px; }

        /* ══ TOAST ══════════════════════════════════════════════════ */
        .toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 9000; display: flex; flex-direction: column; gap: 8px; }
        .toast {
            background: var(--surface2); border: 1px solid var(--border);
            border-radius: 10px; padding: 12px 18px;
            font-size: 13px; font-family: 'Space Mono', monospace;
            max-width: 320px; animation: slideUp .3s cubic-bezier(.16,1,.3,1);
            display: flex; align-items: center; gap: 10px;
        }
        .toast .t-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
        .toast.success .t-dot { background: var(--success); box-shadow: 0 0 6px var(--success); }
        .toast.error .t-dot { background: var(--error); box-shadow: 0 0 6px var(--error); }
        .toast.warning .t-dot { background: var(--warn); box-shadow: 0 0 6px var(--warn); }
        .toast.info .t-dot { background: var(--cyan); box-shadow: 0 0 6px var(--cyan); }

        /* ══ LOADER ════════════════════════════════════════════════ */
        .spin { display: inline-block; width: 14px; height: 14px; border-radius: 50%; border: 2px solid rgba(0,0,0,0.2); border-top-color: var(--bg); animation: spin .7s linear infinite; }

        /* ══ KEYFRAMES ══════════════════════════════════════════════ */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(24px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        @keyframes blink {
            0%,100% { opacity: 1; } 50% { opacity: .3; }
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        @keyframes popIn {
            0% { opacity: 0; transform: scale(.92) translateY(8px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        .hidden { display: none !important; }

        /* ── RESPONSIVE ── */
        @media (max-width: 680px) {
            .user-bar { flex-direction: column; }
            .user-bar-item { border-right: none; border-bottom: 1px solid var(--border); }
            .user-bar-item:last-child { border-bottom: none; }
            .dash-header { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>

<div class="ambient ambient-1"></div>
<div class="ambient ambient-2"></div>

<!-- ══ LOGIN ══ -->
<div id="loginSection">
    <div class="login-card">
        <div class="login-logo"><div class="dot"></div>RATE.LIMITER — CONTROL CENTER</div>
        <div class="login-title">Sign in to<br>your dashboard</div>
        <div class="login-subtitle">Monitor and control API rate limits in real-time.</div>

        <div id="loginAlert"></div>

        <div class="field">
            <label>CLIENT ID</label>
            <input type="text" id="clientID" placeholder="e.g. client1" autocomplete="username" />
        </div>
        <div class="field">
            <label>PASSWORD</label>
            <input type="password" id="password" placeholder="••••••••" autocomplete="current-password" />
        </div>
        <button class="btn-primary" onclick="login()">Continue →</button>
        <div class="login-hint">Demo: <span>client1</span> / <span>mypassword</span></div>
    </div>
</div>

<!-- ══ APP ══ -->
<div id="appSection">
    <div class="container">

        <!-- Header -->
        <div class="dash-header">
            <div>
                <div class="dash-brand"><div class="status-dot"></div>CONNECTED — <span id="authClientID" style="color:var(--cyan)">---</span></div>
                <div class="dash-title">Control <span>Center</span></div>
            </div>
            <div class="dash-actions">
                <button class="btn-ghost" onclick="toggleTheme()" id="themeBtn">Theme: Dark</button>
                <button class="btn-ghost danger" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- User Bar -->
        <div class="user-bar">
            <div class="user-bar-item">
                <div class="ub-label">CLIENT ID</div>
                <div class="ub-value mono" id="ubClientID">---</div>
            </div>
            <div class="user-bar-item">
                <div class="ub-label">SESSION STATUS</div>
                <div class="ub-value online">● Active</div>
            </div>
            <div class="user-bar-item">
                <div class="ub-label">SESSION TIME</div>
                <div class="ub-value mono" id="sessionTime">00:00:00</div>
            </div>
            <div class="user-bar-item">
                <div class="ub-label">SYSTEM HEALTH</div>
                <div class="ub-value">
                    <div class="health-badge stable" id="healthBadge">
                        <div class="h-dot"></div><span id="healthText">Stable</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="sc-label">REQUESTS / SEC</div>
                <div class="sc-value cyan" id="rpsValue">0</div>
                <div class="track"><div class="fill cyan" id="rpsBar" style="width:0%"></div></div>
                <div class="sc-sub">Real-time rate</div>
            </div>
            <div class="stat-card">
                <div class="sc-label">REMAINING QUOTA</div>
                <div class="sc-value teal" id="quotaValue">5</div>
                <div class="track"><div class="fill teal" id="quotaBar" style="width:100%"></div></div>
                <div class="sc-sub" id="quotaInfo">of 5 requests</div>
            </div>
            <div class="stat-card">
                <div class="sc-label">RESET IN</div>
                <div class="sc-value amber" id="resetValue">10s</div>
                <div class="track"><div class="fill amber" id="resetBar" style="width:0%"></div></div>
                <div class="sc-sub">10s window</div>
            </div>
            <div class="stat-card">
                <div class="sc-label">TOTAL REQUESTS</div>
                <div class="sc-value violet" id="totalValue">0</div>
                <div class="track"><div class="fill violet" id="totalBar" style="width:0%"></div></div>
                <div class="sc-sub">Session count</div>
            </div>
        </div>

        <!-- Gauge -->
        <div class="gauge-section">
            <div class="gauge-wrap">
                <svg class="gauge-svg" width="160" height="160" viewBox="0 0 160 160">
                    <circle class="gauge-bg" cx="80" cy="80" r="65"/>
                    <circle class="gauge-fill" id="gaugeFill" cx="80" cy="80" r="65"/>
                </svg>
                <div class="gauge-center">
                    <div class="gauge-pct" id="gaugePct">0%</div>
                    <div class="gauge-desc">USAGE</div>
                </div>
            </div>
            <div class="gauge-legend">
                <div class="gauge-legend-item">
                    <div class="gl-dot" style="background:var(--success)"></div>
                    <span class="gl-label">Success</span>
                    <span class="gl-val" id="lgSuccess" style="color:var(--success)">0</span>
                </div>
                <div class="gauge-legend-item">
                    <div class="gl-dot" style="background:var(--error)"></div>
                    <span class="gl-label">Blocked</span>
                    <span class="gl-val" id="lgBlocked" style="color:var(--error)">0</span>
                </div>
                <div class="gauge-legend-item">
                    <div class="gl-dot" style="background:var(--warn)"></div>
                    <span class="gl-label">Warning</span>
                    <span class="gl-val" id="lgWarn" style="color:var(--warn)">0</span>
                </div>
                <div class="gauge-legend-item" style="border-top:1px solid var(--border); padding-top:10px; margin-top:4px;">
                    <div class="gl-dot" style="background:var(--text-dim)"></div>
                    <span class="gl-label">Total</span>
                    <span class="gl-val" id="lgTotal" style="color:var(--text)">0</span>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls-row">
            <button class="btn-action primary" id="sendBtn" onclick="sendRequest()">
                <span id="sendBtnContent">↑ Send Request</span>
            </button>
            <button class="btn-action outline" onclick="clearLog()">Clear Log</button>
            <button class="btn-action outline" onclick="toggleAnalyticsPanel()">Analytics ↓</button>
        </div>

        <!-- Log -->
        <div class="log-section">
            <div class="log-header-bar">
                <div class="log-title-text">REQUEST LOG</div>
                <div class="filter-pills">
                    <div class="pill active" onclick="filterLog('all',this)">All</div>
                    <div class="pill" onclick="filterLog('success',this)">Success</div>
                    <div class="pill" onclick="filterLog('blocked',this)">Blocked</div>
                    <div class="pill" onclick="filterLog('warning',this)">Warning</div>
                </div>
            </div>
            <div class="log-body" id="logContainer">
                <div class="log-empty" id="logEmpty">No requests yet. Hit ↑ Send Request to begin.</div>
            </div>
        </div>

        <!-- API Tester -->
        <div class="tester-section">
            <div class="section-title">API TESTER</div>
            <div class="tester-row">
                <input class="tester-input" type="text" id="testerEndpoint" placeholder="/api/endpoint" />
                <button class="btn-action primary" onclick="testEndpoint()">Test</button>
            </div>
            <pre class="tester-output" id="testerOutput"></pre>
        </div>

        <!-- Analytics -->
        <div class="analytics-section" id="analyticsSection">
            <div class="analytics-toggle" onclick="toggleAnalyticsPanel()">
                <div class="section-title" style="margin:0">ANALYTICS DASHBOARD</div>
                <div class="analytics-toggle-icon" id="analyticsIcon">▼</div>
            </div>
            <div class="analytics-body" id="analyticsBody">
                <div class="charts-grid">
                    <div class="chart-box">
                        <div class="chart-label">REQUESTS OVER TIME</div>
                        <canvas id="frequencyChart"></canvas>
                    </div>
                    <div class="chart-box">
                        <div class="chart-label">SUCCESS RATIO</div>
                        <canvas id="ratioChart"></canvas>
                    </div>
                    <div class="chart-box">
                        <div class="chart-label">RESPONSE TIME (ms)</div>
                        <canvas id="responseChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div><!-- /container -->
</div><!-- /appSection -->

<div class="toast-container" id="toastContainer"></div>

<script>
// ─── STATE ───────────────────────────────────────────────
const API_URL = "http://localhost:8080";
let authToken = null, currentClientID = null;
let requestCount=0, successCount=0, blockedCount=0, warningCount=0;
let sessionStart=null;
let requestTimestamps=[], requestResponseTimes=[];
let rateLimitMax=5, rateLimitWindow=10;
let audioCtx=null, soundEnabled=true;
let isDark=true;
let charts={};
let currentFilter='all';
let analyticsOpen=false;

// ─── INIT ─────────────────────────────────────────────────
document.addEventListener('DOMContentLoaded', () => {
    const savedAuth  = localStorage.getItem('authToken');
    const savedCID   = localStorage.getItem('currentClientID');
    soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
    isDark       = localStorage.getItem('theme') !== 'light';
    applyTheme();
    updateSoundBtn();

    if (savedAuth && savedCID) {
        authToken = savedAuth; currentClientID = savedCID;
        sessionStart = Date.now();
        showApp();
    }

    document.addEventListener('keydown', e => {
        if (e.key==='Enter' && !authToken) login();
    });

    try { audioCtx = new (window.AudioContext||window.webkitAudioContext)(); } catch(_) {}
});

// ─── THEME ────────────────────────────────────────────────
function toggleTheme() {
    isDark = !isDark;
    localStorage.setItem('theme', isDark?'dark':'light');
    applyTheme(); playNote('click');
}
function applyTheme() {
    // This UI is always dark; light mode just brightens surfaces slightly
    document.body.style.background = isDark ? '' : '#111827';
    const themeBtn = document.getElementById('themeBtn');
    if (themeBtn) themeBtn.textContent = isDark ? 'Theme: Dark' : 'Theme: Light';
}

// ─── SOUND ────────────────────────────────────────────────
function toggleSound() {
    soundEnabled = !soundEnabled;
    localStorage.setItem('soundEnabled', soundEnabled);
    updateSoundBtn(); playNote('click');
}
function updateSoundBtn() {
    const soundBtn = document.getElementById('soundBtn');
    if (!soundBtn) return;
    soundBtn.textContent = soundEnabled ? 'Mute' : 'Unmute';
}
function playNote(type) {
    if (!soundEnabled||!audioCtx) return;
    const t = audioCtx.currentTime;
    const notes = {
        success: [[523,.08,t],[659,.08,t+.1]],
        error:   [[200,.2,t]],
        warning: [[330,.15,t]],
        click:   [[800,.04,t]],
        request: [[440,.07,t],[554,.07,t+.08]]
    };
    (notes[type]||[]).forEach(([f,d,s]) => {
        const o=audioCtx.createOscillator(), g=audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination);
        o.frequency.value=f; o.type='sine';
        g.gain.setValueAtTime(.25,s);
        g.gain.exponentialRampToValueAtTime(.001,s+d);
        o.start(s); o.stop(s+d);
    });
}

// ─── AUTH ─────────────────────────────────────────────────
function login() {
    const cid=document.getElementById('clientID').value.trim();
    const pwd=document.getElementById('password').value.trim();
    const alert=document.getElementById('loginAlert');
    if(!cid||!pwd){ showLoginAlert('Both fields are required.','error'); playNote('error'); return; }

    fetch(`${API_URL}/auth/login`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body:JSON.stringify({clientID:cid,password:pwd})
    })
    .then(r=>r.json())
    .then(d=>{
        if(d.error){ showLoginAlert(d.error,'error'); playNote('error'); document.getElementById('password').value=''; return; }
        authToken=d.token; currentClientID=cid; sessionStart=Date.now();
        localStorage.setItem('authToken',authToken); localStorage.setItem('currentClientID',currentClientID);
        showLoginAlert('Authenticated.','success'); playNote('success');
        setTimeout(()=>{ showApp(); },700);
    })
    .catch(()=>{ showLoginAlert('Cannot connect to server.','error'); playNote('error'); });
}

function logout() {
    authToken=null; currentClientID=null;
    requestCount=successCount=blockedCount=warningCount=0;
    requestTimestamps=[]; requestResponseTimes=[]; sessionStart=null;
    localStorage.removeItem('authToken'); localStorage.removeItem('currentClientID');
    document.getElementById('clientID').value=''; document.getElementById('password').value='';
    document.getElementById('logContainer').innerHTML='<div class="log-empty" id="logEmpty">No requests yet. Hit ↑ Send Request to begin.</div>';
    updateStats();
    document.getElementById('appSection').classList.remove('visible');
    document.getElementById('loginSection').style.display='flex';
    playNote('click');
}

function showLoginAlert(msg,type) {
    const el=document.getElementById('loginAlert');
    el.textContent=msg; el.className=type; el.style.display='block';
}

function showApp() {
    document.getElementById('loginSection').style.display='none';
    document.getElementById('appSection').classList.add('visible');
    document.getElementById('authClientID').textContent = currentClientID;
    document.getElementById('ubClientID').textContent = currentClientID;
    startSessionTimer(); initCharts(); updateStats();
}

// ─── REQUEST ──────────────────────────────────────────────
function sendRequest() {
    if(!authToken) { showToast('Not authenticated','error'); return; }
    const btn=document.getElementById('sendBtn');
    const orig=btn.innerHTML;
    btn.innerHTML='<span id="sendBtnContent"><span class="spin"></span></span>';
    btn.disabled=true;
    const t0=performance.now(), ts=new Date();

    fetch(API_URL, {
        method:'GET', headers:{
            'X-Client-ID':currentClientID,
            'Authorization':`Bearer ${authToken}`,
            'Content-Type':'application/json'
        }
    })
    .then(r=>r.json().then(d=>({ok:r.ok,status:r.status,data:d,rt:performance.now()-t0})))
    .then(res=>{
        requestCount++;
        requestTimestamps.push(ts);
        requestResponseTimes.push(res.rt);
        // trim to 60s
        const cut=Date.now()-60000;
        const keep=requestTimestamps.findIndex(t=>t.getTime()>cut);
        if(keep>0){ requestTimestamps=requestTimestamps.slice(keep); requestResponseTimes=requestResponseTimes.slice(keep); }

        let type;
        if(res.ok){ successCount++; type='success'; playNote('success'); }
        else if(res.status===429){ blockedCount++; type='blocked'; playNote('error'); }
        else{ warningCount++; type='warning'; playNote('warning'); }

        const entry={id:requestCount,ts,endpoint:'/',type,rt:res.rt,msg:res.data.message||'OK'};
        addLogEntry(entry); updateStats(); updateHealth();
        showToast(`${type==='success'?'✓':type==='blocked'?'✗':'⚠'} #${requestCount} — ${entry.msg}`, type);
    })
    .catch(()=>{ showToast('Server unreachable','error'); playNote('error'); })
    .finally(()=>{ btn.innerHTML=orig; btn.disabled=false; });
}

function testEndpoint() {
    const ep=document.getElementById('testerEndpoint').value.trim();
    const out=document.getElementById('testerOutput');
    if(!ep){ out.textContent='Error: enter an endpoint'; out.classList.add('show'); return; }
    if(!authToken){ out.textContent='Error: not authenticated'; out.classList.add('show'); return; }
    out.textContent='Fetching...'; out.classList.add('show');
    fetch(`${API_URL}${ep}`,{headers:{'X-Client-ID':currentClientID,'Authorization':`Bearer ${authToken}`}})
        .then(r=>r.json()).then(d=>{ out.textContent=JSON.stringify(d,null,2); playNote('success'); })
        .catch(e=>{ out.textContent=`Error: ${e.message}`; playNote('error'); });
}

// ─── LOG ──────────────────────────────────────────────────
function addLogEntry(entry) {
    const container=document.getElementById('logContainer');
    const empty=document.getElementById('logEmpty');
    if(empty) empty.remove();

    const div=document.createElement('div');
    div.className=`log-entry ${entry.type}`;
    div.dataset.type=entry.type;
    div.innerHTML=`
        <div class="log-entry-dot"></div>
        <div class="log-entry-main">
            <div class="log-entry-ep">GET ${entry.endpoint}</div>
            <div class="log-entry-msg">${entry.msg}</div>
        </div>
        <div class="log-entry-right">
            <div class="log-entry-time">${entry.ts.toLocaleTimeString()}</div>
            <div class="log-entry-rt">${Math.round(entry.rt)}ms</div>
        </div>
    `;

    const detail=document.createElement('div');
    detail.className='log-detail';
    detail.innerHTML=`
        <div class="ld-row"><span class="ld-k">id:</span><span class="ld-v">#${entry.id}</span></div>
        <div class="ld-row"><span class="ld-k">type:</span><span class="ld-v">${entry.type.toUpperCase()}</span></div>
        <div class="ld-row"><span class="ld-k">time:</span><span class="ld-v">${entry.ts.toLocaleString()}</span></div>
        <div class="ld-row"><span class="ld-k">latency:</span><span class="ld-v">${Math.round(entry.rt)}ms</span></div>
    `;

    div.addEventListener('click', () => {
        detail.classList.toggle('open');
        playNote('click');
    });

    container.insertBefore(detail, container.firstChild);
    container.insertBefore(div, container.firstChild);

    if(currentFilter!=='all' && entry.type!==currentFilter) {
        div.style.display='none'; detail.style.display='none';
    }
    while(container.children.length>200) container.removeChild(container.lastChild);
}

function filterLog(filter, el) {
    currentFilter=filter;
    document.querySelectorAll('.pill').forEach(p=>p.classList.remove('active'));
    if(el) el.classList.add('active');
    document.querySelectorAll('.log-entry').forEach(e=>{
        e.style.display=(filter==='all'||e.dataset.type===filter)?'':'none';
    });
    playNote('click');
}

function clearLog() {
    document.getElementById('logContainer').innerHTML='<div class="log-empty" id="logEmpty">Log cleared.</div>';
    requestCount=successCount=blockedCount=warningCount=0;
    requestTimestamps=[]; requestResponseTimes=[];
    updateStats(); showToast('Log cleared','info'); playNote('click');
}

// ─── STATS ────────────────────────────────────────────────
function updateStats() {
    const now=Date.now();
    const sec1=now-1000, win=now-rateLimitWindow*1000;

    const rps=requestTimestamps.filter(t=>t.getTime()>sec1).length;
    const wReqs=requestTimestamps.filter(t=>t.getTime()>win).length;
    const remaining=Math.max(0,rateLimitMax-wReqs);
    const pct=Math.min(100,Math.round((wReqs/rateLimitMax)*100));

    setVal('rpsValue',rps); setBar('rpsBar',Math.min(100,(rps/10)*100));
    setVal('quotaValue',remaining); setBar('quotaBar',(remaining/rateLimitMax)*100);
    document.getElementById('quotaInfo').textContent=`of ${rateLimitMax} requests`;

    if(requestTimestamps.length>0){
        const oldest=requestTimestamps[0];
        const left=Math.max(0,rateLimitWindow-((now-oldest.getTime())/1000));
        setVal('resetValue',Math.ceil(left)+'s');
        setBar('resetBar',((rateLimitWindow-left)/rateLimitWindow)*100);
    }

    setVal('totalValue',requestCount); setBar('totalBar',Math.min(100,(requestCount/20)*100));
    setVal('lgSuccess',successCount); setVal('lgBlocked',blockedCount);
    setVal('lgWarn',warningCount); setVal('lgTotal',requestCount);

    // gauge
    const circumference=2*Math.PI*65;
    const fill=document.getElementById('gaugeFill');
    const offset=circumference*(1-pct/100);
    fill.style.strokeDasharray=circumference;
    fill.style.strokeDashoffset=offset;
    // color transition
    if(pct<50) { fill.style.stroke='var(--cyan)'; }
    else if(pct<80) { fill.style.stroke='var(--amber)'; }
    else { fill.style.stroke='var(--error)'; }
    setVal('gaugePct',pct+'%');

    if(analyticsOpen&&charts.ratio) updateCharts();
}

function setVal(id,v){ const el=document.getElementById(id); if(el) el.textContent=v; }
function setBar(id,pct){ const el=document.getElementById(id); if(el) el.style.width=pct+'%'; }

function updateHealth() {
    const now=Date.now();
    const wReqs=requestTimestamps.filter(t=>t.getTime()>(now-rateLimitWindow*1000)).length;
    const pct=(wReqs/rateLimitMax)*100;
    const badge=document.getElementById('healthBadge');
    const text=document.getElementById('healthText');
    badge.className='health-badge '+(pct<50?'stable':pct<80?'warning':'danger');
    text.textContent=pct<50?'Stable':pct<80?'Near Limit':'Blocked';
}

function startSessionTimer() {
    setInterval(()=>{
        if(!sessionStart) return;
        const e=Math.floor((Date.now()-sessionStart)/1000);
        const h=Math.floor(e/3600), m=Math.floor((e%3600)/60), s=e%60;
        setVal('sessionTime',[h,m,s].map(x=>String(x).padStart(2,'0')).join(':'));
        updateStats();
    },1000);
}

// ─── ANALYTICS ────────────────────────────────────────────
function toggleAnalyticsPanel() {
    analyticsOpen=!analyticsOpen;
    document.getElementById('analyticsBody').classList.toggle('open',analyticsOpen);
    document.getElementById('analyticsIcon').classList.toggle('open',analyticsOpen);
    playNote('click');
    if(analyticsOpen) setTimeout(updateCharts,100);
}

function initCharts() {
    const opts=(label,color)=>(
        {
            responsive:true, maintainAspectRatio:false,
            plugins:{legend:{display:false},tooltip:{bodyColor:'#e8edf5',titleColor:color,backgroundColor:'#161e2e',borderColor:'rgba(255,255,255,0.07)',borderWidth:1}},
            scales:{
                y:{beginAtZero:true,ticks:{color:'#6b7a94',font:{family:"'Space Mono',monospace",size:10}},grid:{color:'rgba(255,255,255,0.04)'}},
                x:{ticks:{color:'#6b7a94',font:{family:"'Space Mono',monospace",size:10}},grid:{color:'rgba(255,255,255,0.04)'}}
            }
        }
    );

    charts.freq=new Chart(document.getElementById('frequencyChart').getContext('2d'),{
        type:'line',
        data:{labels:[],datasets:[{label:'Req/min',data:[],borderColor:'#3de6f5',backgroundColor:'rgba(61,230,245,0.06)',tension:.4,fill:true,borderWidth:2,pointRadius:3,pointBackgroundColor:'#3de6f5'}]},
        options:{...opts('Req/min','#3de6f5')}
    });

    charts.ratio=new Chart(document.getElementById('ratioChart').getContext('2d'),{
        type:'doughnut',
        data:{labels:['Success','Blocked','Warning'],datasets:[{data:[0,0,0],backgroundColor:['rgba(0,229,160,0.85)','rgba(255,77,109,0.85)','rgba(245,166,35,0.85)'],borderColor:'#0f1520',borderWidth:2}]},
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#a0aec0',font:{family:"'Space Mono',monospace",size:10}}}}}
    });

    charts.resp=new Chart(document.getElementById('responseChart').getContext('2d'),{
        type:'bar',
        data:{labels:[],datasets:[{label:'ms',data:[],backgroundColor:'rgba(155,114,255,0.5)',borderColor:'#9b72ff',borderWidth:1,borderRadius:3}]},
        options:{...opts('ms','#9b72ff')}
    });
}

function updateCharts() {
    if(!charts.freq) return;
    const now=Date.now();
    const freq=[];
    for(let i=9;i>=0;i--){
        const from=now-(i+1)*60000, to=now-i*60000;
        freq.push(requestTimestamps.filter(t=>t.getTime()>=from&&t.getTime()<to).length);
    }
    charts.freq.data.labels=freq.map((_,i)=>`-${9-i}m`);
    charts.freq.data.datasets[0].data=freq;
    charts.freq.update();

    charts.ratio.data.datasets[0].data=[successCount||0,blockedCount||0,warningCount||0];
    charts.ratio.update();

    const last10=requestResponseTimes.slice(-10);
    charts.resp.data.labels=last10.map((_,i)=>`R${i+1}`);
    charts.resp.data.datasets[0].data=last10.map(v=>Math.round(v));
    charts.resp.update();
}

// ─── TOAST ────────────────────────────────────────────────
function showToast(msg, type) {
    const c=document.getElementById('toastContainer');
    const t=document.createElement('div');
    t.className=`toast ${type}`;
    t.innerHTML=`<div class="t-dot"></div><span>${msg}</span>`;
    c.appendChild(t);
    setTimeout(()=>{ t.style.opacity='0'; t.style.transition='opacity .3s'; setTimeout(()=>t.remove(),300); },3000);
}
</script>
</body>
</html>
